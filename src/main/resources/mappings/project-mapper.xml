<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project">

	<!-- 부등호를 태그로 인식해서 발생하는 에러를 CDATA로 처리   -->
	<select id="bestItemList" parameterType="project" resultType="project">
		<![CDATA[
		SELECT * FROM PROJECT WHERE PRO_CATENO = '4' AND ROWNUM <= 4
		]]>
	</select>
	
	<select id="recommendItemList" parameterType="project" resultType="project">
		<![CDATA[
		SELECT * FROM PROJECT WHERE PRO_CATENO = '2' AND ROWNUM <= 4
		]]>
	</select>
	
	<select id="hashTagItemList" parameterType="project" resultType="project">
		<![CDATA[
		SELECT * FROM PROJECT WHERE PRO_CATENO = '5' AND ROWNUM <= 4
		]]>
	</select>
	
	<select id="searchItemList" parameterType="string" resultType="project">
		<![CDATA[
		SELECT * FROM PROJECT
		WHERE PRO_STITLE LIKE '%'||#{pro_stitle}||'%' AND ROWNUM <= 4
		]]>
	</select>
	
	<select id="selectProject" parameterType="project" resultType="project">
		SELECT * FROM USERS ORDER BY USER_NO
	</select>
	
	<select id="selectOneProject" parameterType="string" resultType="project">
		SELECT * FROM USERS WHERE USER_ID = #{id}
	</select>
	
	<select id="checkIdPassword" parameterType="map" resultType="project">
		SELECT * FROM USERS WHERE USER_ID = #{user_id} AND USER_PWD = #{user_pwd} AND USER_TYPE = '회원'
	</select>
	
	<insert id="insertProject" parameterType="project">
		INSERT INTO USERS (USER_NO, USER_NAME, USER_ID, USER_PWD, USER_PHONE, USER_EMAIL, USER_GENDER, USER_JOINDATE, USER_TYPE, USER_ADDRESS, USER_ADDRESS_NUMBER)
		VALUES ((SELECT NVL(MAX(USER_NO),0)+1 FROM USERS), #{user_name}, #{user_id}, #{user_pwd}, #{user_phone}, #{user_email}, #{user_gender}, sysdate, '회원', #{user_address}, #{user_address_number})
	</insert>
	
	<update id="updateProject" parameterType="project">
		UPDATE USERS SET 
			USER_PWD = #{user_pwd}, 
			USER_PHONE = #{user_phone}, 
			USER_EMAIL = #{user_email},
			USER_ADDRESS = #{user_address}, 
			USER_ADDRESS_NUMBER = #{user_address_number}
        WHERE USER_ID = #{user_id}
	</update>
	
	<delete id="deleteProject" parameterType="project">
		UPDATE USERS SET 
			USER_TYPE = '탈퇴 회원',
			USER_WITHDRAWAL_REASON = #{user_withdrawal_reason}
		WHERE USER_ID = #{user_id}
	</delete>
</mapper>